<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Grammar Diagnostic Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .word-box, .sentence {
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .word {
            margin: 5px;
            padding: 5px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            display: inline-block;
        }
        .blank {
            display: inline-block;
            width: 100px;
            height: 20px;
            margin: 5px;
            padding: 5px;
            background-color: #fff;
            border: 1px dashed #aaa;
            vertical-align: middle;
        }
        .highlight {
            border-color: #f90;
            background-color: #ffc;
        }
        .hovered {
            background-color: #e0e0e0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        .name-input-container, .greeting, .saved-data {
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="name-input-container">
    <label for="studentName">이름: </label>
    <input type="text" id="studentName" placeholder="Your Name">
    <button id="startButton">Start</button>
</div>

<div class="greeting" style="display:none;"></div>
<div class="saved-data"></div> <!-- Display saved data here -->

<div class="container">
    <h2>Word Choices</h2>
    <div id="wordChoices" class="word-box"></div>

    <h2>Fill in the Blanks</h2>
    <div id="sentences"></div>

    <button id="checkAnswers">Check Answers</button>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
<script>
$(function() {
    const words = ["meticulously", "concisely", "preliminary", "altogether", "transaction", "specify", "exempt", "authorization", "ingredient", "approximately"];
    const sentences = [
        { text: "He worked ___ on his project to ensure it was perfect.", answer: "meticulously" },
        { text: "The professor explained the topic ___.", answer: "concisely" },
        { text: "Before the main study, we conducted ___ research.", answer: "preliminary" },
        { text: "Due to unforeseen circumstances, the project was cancelled ___.", answer: "altogether" },
        { text: "The ___ between the two companies was finalized yesterday.", answer: "transaction" },
        { text: "It's important to ___ the requirements before proceeding.", answer: "specify" },
        { text: "Certain products are ___ from the sales tax.", answer: "exempt" },
        { text: "Accessing the secure area requires special ___.", answer: "authorization" },
        { text: "Flour is a basic ___ in bread making.", answer: "ingredient" },
        { text: "The journey should take ___ two hours by train.", answer: "approximately" }
    ];

    words.forEach(word => {
        $('#wordChoices').append(`<div class="word">${word}</div>`);
    });

    sentences.forEach((sentence, index) => {
        $('#sentences').append(`<div class="sentence">${index + 1}. ${sentence.text.replace('___', `<div class="blank" data-answer="${sentence.answer}" data-index="${index}"></div>`)}</div>`);
    });

    $('.word').draggable({
        helper: 'clone',
        revert: 'invalid',
    });

    $('.blank').droppable({
        accept: '.word',
        drop: function(event, ui) {
            $(this).text(ui.draggable.text());
            $(this).droppable('disable');
            $(this).addClass('highlight'); // Mark the answer visually
        }
    });

    $('#startButton').on('click', function() {
        var name = $('#studentName').val();
        if (name) {
            $('.greeting').html(`<h3>, ${name}!</h3>`).show();
        } else {
            alert(' Nname 을 입력해주세요.');
        }
    });

    function saveScore(name, score) {
        var scriptUrl = 'https://script.google.com/macros/s/AKfycbymEsDBUZNDuiUNjzGSbKUsZfv_NqOLq2kXSy0F7lqcaMSmnKRQRKpSC_m5QTQdoHhoYA/exec'; // Replace with your actual script URL
        fetch(scriptUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({name: name, score: score})
        })
        .then(response => response.json())
        .then(data => {
    if(data.status === "success") {
        alert(`${name}, your score of ${score} has been saved successfully.`);
        $('.saved-data').html(`<p>Last saved data: Name - ${name}, Score - ${score}</p>`); // Display saved data
    } else {
        alert('Failed to save data.');
    }
})
        .catch((error) => {
            console.error('Error:', error);
            alert('Failed to save data. Please check your internet connection and try again.');
        });
    }

    $('#checkAnswers').on('click', function() {
    let score = 0;
    $('.blank').each(function() {
        const userAnswer = $(this).text().trim();
        const correctAnswer = $(this).data('answer');
        if (userAnswer === correctAnswer) {
            score++;
            $(this).css('background-color', 'lightgreen');
        } else {
            $(this).css('background-color', 'salmon');
        }
    });

    let name = $('#studentName').val();
    // Display the name and score immediately in the HTML before saving
    if(name) {
        $('.greeting').html(`<h3>Score for ${name}: ${score} out of 10</h3>`).show();
    } else {
        alert('Please enter your name.');
        return; // Don't proceed with saving if name is not entered
    }

    // Proceed to save the score
    saveScore(name, score);
});
});
</script>
</body>
</html>
